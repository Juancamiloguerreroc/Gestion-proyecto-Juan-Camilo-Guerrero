<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión | Sistema de Gestión</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">GestServ</div>
        <nav id="main-nav">
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="login.html" class="active" id="loginLink">Iniciar Sesión</a></li>
                <li><a href="register.html" id="registerLink">Registro</a></li>
                <li class="hidden" id="adminLink"><a href="admin.html">Panel Admin</a></li>
                <li class="hidden" id="viewerLink"><a href="viewer.html">Panel Viewer</a></li>
                <li class="hidden" id="logoutBtn"><a href="#">Cerrar Sesión</a></li>
            </ul>
        </nav>
        <div class="menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <main>
        <div class="form-container">
            <h2 class="form-title">Iniciar Sesión</h2>
            <div id="loginMessage" class="alert hidden"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Correo electrónico</label>
                    <input type="email" id="email" class="form-control" required>
                    <div class="form-error" id="emailError"></div>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" class="form-control" required>
                    <div class="form-error" id="passwordError"></div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn primary" style="width: 100%;">
                        <span>Ingresar</span>
                        <span class="loader hidden" id="loginLoader"></span>
                    </button>
                </div>
                <p class="text-center">¿No tienes cuenta? <a href="register.html">Regístrate aquí</a></p>
            </form>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h4>GestorApp</h4>
                <p>Sistema de gestión simple y efectivo</p>
            </div>
            <div class="footer-section">
                <h4>Enlaces</h4>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="contact.html">Contacto</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contacto</h4>
                <p>info@gestorapp.com</p>
                <p>+34 600 000 000</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 GestorApp. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Comprobar si ya hay sesión activa
            const session = getCurrentSession();
            if (session) {
                window.location.href = session.role === 'admin' ? 'admin.html' : 'viewer.html';
                return;
            }
            
            // Inicializar UI
            checkSession();
            
            // Manejo de formulario
            const loginForm = document.getElementById('loginForm');
            const loginMessage = document.getElementById('loginMessage');
            const loginLoader = document.getElementById('loginLoader');
            
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // Reset errores
                document.getElementById('emailError').textContent = '';
                document.getElementById('passwordError').textContent = '';
                loginMessage.classList.add('hidden');
                
                // Datos del formulario
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                
                // Validación básica
                let isValid = true;
                
                if (!email) {
                    document.getElementById('emailError').textContent = 'El correo es obligatorio';
                    isValid = false;
                } else if (!/\S+@\S+\.\S+/.test(email)) {
                    document.getElementById('emailError').textContent = 'Formato de correo inválido';
                    isValid = false;
                }
                
                if (!password) {
                    document.getElementById('passwordError').textContent = 'La contraseña es obligatoria';
                    isValid = false;
                }
                
                if (!isValid) return;
                
                // Mostrar loader
                const submitBtn = loginForm.querySelector('button[type="submit"] span:not(.loader)');
                submitBtn.classList.add('hidden');
                loginLoader.classList.remove('hidden');
                
                // Simulamos un pequeño delay para mostrar el loader
                setTimeout(() => {
                    const result = login(email, password);
                    
                    if (result.success) {
                        loginMessage.textContent = 'Inicio de sesión exitoso. Redirigiendo...';
                        loginMessage.classList.remove('hidden', 'alert-danger');
                        loginMessage.classList.add('alert-success');
                        
                        setTimeout(() => {
                            window.location.href = result.user.role === 'admin' ? 'admin.html' : 'viewer.html';
                        }, 1000);
                    } else {
                        loginMessage.textContent = result.message;
                        loginMessage.classList.remove('hidden', 'alert-success');
                        loginMessage.classList.add('alert-danger', 'alert');
                        
                        // Ocultar loader
                        submitBtn.classList.remove('hidden');
                        loginLoader.classList.add('hidden');
                    }
                }, 500);
            });
            
            // Toggle menú móvil
            document.querySelector('.menu-toggle').addEventListener('click', () => {
                document.querySelector('#main-nav').classList.toggle('active');
            });
        });
    </script>
</body>
</html>